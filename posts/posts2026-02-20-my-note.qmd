---
title: "Multi-trip VRP: quick notes"
date: 2026-02-20
description: "Multi-trip VRP에서 trip/tour 인덱스가 왜 필요한지, 대표 수식 구조를 짧게 정리."
categories: [VRP, Optimization]
toc: true
toc-depth: 3
---

## TL;DR

- **Multi-trip VRP**: 한 차량이 하루에 여러 번 depot을 출발/복귀(여러 투어 수행)
- 모델링에서 보통 **trip 인덱스(r)** 또는 **route(tour) 인덱스(m)**가 필요해짐
- 인덱스를 넣는 방식에 따라 모델 크기/대칭성/해법(컬럼 생성 등)이 달라짐

## 언제 trip 인덱스가 필요해지나?

- 차량 1대가 오전/오후로 **2번 이상** depot에서 출발해서 서로 다른 고객군을 방문
- 각 trip마다
  - 출발/복귀 시간이 다르고
  - 적재/재고 제약(또는 근무시간 제약)을 따로 적용해야 하는 경우

## 의사코드

```text
for vehicle k in Vehicles:
  for trip r in 1..R_k:
    start at depot
    visit a sequence of customers
    return to depot
```

## 최소 수식 스케치(개념)

- `k`: vehicle
- `r`: trip index
- `i, j`: nodes (depot 포함)
- `x_{i,j,k,r} ∈ {0,1}`: trip r에서 k가 i→j 이동하면 1

```text
(Flow)   Σ_j x_{i,j,k,r} = Σ_j x_{j,i,k,r}      for all i, k, r
(Depot)  Σ_j x_{depot,j,k,r} = 1                for all k, r
         Σ_i x_{i,depot,k,r} = 1                for all k, r
```

> 위 스케치는 “각 trip이 depot에서 시작해서 depot으로 끝나는 경로”를 의미함.

## Python 코드 스니펫

```python
def total_time(trips):
    """trips: list of dicts with keys 'travel' and 'service' (both numeric)."""
    return sum(t["travel"] + t["service"] for t in trips)
```

## 메모

- trip 인덱스를 명시하면 직관은 좋아지지만, 변수 수가 커지고 대칭성이 생기기 쉬움
- 큰 문제에서는 “trip을 직접 만들기”보다 “route(투어) 단위 컬럼 생성” 접근이 자주 등장함
